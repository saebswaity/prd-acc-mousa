## أولاً: تفصيل محرك المنطق والقواعد (Logic & Rules Engine)

محرك المنطق هو **"العقل"** لنظام `dynacc.ai`. إنه الجزء الذي يحول المدخلات البسيطة التي يقوم بها المستخدم (مثل بيع سيارة بسعر معين) إلى قيود محاسبية دقيقة ومعقدة. بدلاً من أن يكون القيد ثابتاً (دائماً من حساب X إلى حساب Y)، يقوم المحرك بتنفيذ مجموعة من التعليمات والقواعد التي تحددها أنت في **مرحلة التكوين**.

لنبسط الفكرة: تخيل أن كل حركة تجارية هي **وصفة طبخ**.

- **المدخلات (Inputs):** هي المكونات التي يضيفها المستخدم (مثل: كمية، سعر، اسم عميل).
- **محرك المنطق (Logic Engine):** هو خطوات الوصفة (اخلط المكونات، أضف البهارات بنسبة معينة، اطهها لمدة محددة).
- **المخرجات (Output):** هو الطبق النهائي، وهو هنا **القيد المحاسبي الصحيح**.

### سيناريو في مرحلة التكوين (دور فريق dynacc.ai)

**الهدف:** تكوين حركة "فاتورة بيع سيارة" لشركة سيارات.

1.  **تحديد المدخلات:** يحدد فريقنا الحقول التي سيراها موظف المبيعات في الشركة:

    - `customer_name` (اسم العميل)
    - `car_model` (موديل السيارة)
    - `sale_price` (سعر البيع)
    - `discount_percentage` (نسبة الخصم إن وجدت)

2.  **كتابة المنطق (القواعد):** يقوم فريقنا بكتابة المنطق الذي سيعمل خلف الكواليس. يمكن أن يكون هذا المنطق على شكل خطوات بسيطة:

    ```
    // 1. حسابات داخلية
    cost_of_car = GET_COST(car_model) // جلب تكلفة السيارة من حساب المخزون
    vat_rate = 0.16 // تحديد نسبة الضريبة (16%)

    // 2. الحسابات الرئيسية
    price_after_discount = sale_price - (sale_price * discount_percentage)
    vat_amount = price_after_discount * vat_rate
    total_due = price_after_discount + vat_amount

    // 3. توجيه القيد المحاسبي
    DEBIT(Accounts_Receivable, total_due) // مدين: حساب الذمم المدينة بالمبلغ الإجمالي
    CREDIT(Sales_Revenue, price_after_discount) // دائن: حساب إيراد المبيعات بسعر البيع بعد الخصم
    CREDIT(VAT_Payable, vat_amount) // دائن: حساب ضريبة القيمة المضافة المستحقة
    DEBIT(Cost_of_Goods_Sold, cost_of_car) // مدين: حساب تكلفة البضاعة المباعة بتكلفة السيارة
    CREDIT(Inventory_Cars, cost_of_car) // دائن: حساب مخزون السيارات لإخراج السيارة منه
    ```

### سيناريو في مرحلة الاستخدام (دور محاسب شركة السيارات)

**الهدف:** تسجيل عملية بيع سيارة واحدة.

المحاسب يفتح شاشة "إصدار فاتورة بيع سيارة" ويرى فقط الحقول البسيطة:

- **اسم العميل:** شركة الأمل التجارية
- **موديل السيارة:** Toyota Camry 2025
- **سعر البيع:** 100,000
- **نسبة الخصم:** 0

عندما يضغط على "حفظ"، يقوم **محرك المنطق** بتنفيذ جميع الخطوات المعقدة في الخلفية فوراً، ويقوم بإنشاء القيد المحاسبي الخماسي (من 5 أطراف) بشكل آلي ودقيق دون أي تدخل من المحاسب. هذا هو جوهر قوة النظام.

---

## ثانياً: مثال عملي - نظام محاسبة لشركة بيع سيارات

لنبني نظاماً لهذه الشركة خطوة بخطوة.

### الخطوة 1: مرحلة التكوين (بواسطة فريق dynacc.ai)

#### أ. تصميم شجرة الحسابات (Chart of Accounts)

سنقوم بإنشاء الحسابات الأساسية التي تحتاجها الشركة:

- **الأصول (Assets)**
  - 1100: الأصول المتداولة
    - 1110: الصندوق (Cash)
    - 1120: البنك (Bank)
    - 1130: مخزون السيارات (Inventory - Cars)
    - 1140: الذمم المدينة - عملاء (Accounts Receivable)
- **المصاريف (Expenses)**
  - 5100: تكلفة البضاعة المباعة (Cost of Goods Sold - COGS)
- **الإيرادات (Revenues)**
  - 4100: إيرادات مبيعات السيارات (Sales Revenue)
- **الخصوم (Liabilities)**
  - 2100: الخصوم المتداولة
    - 2110: ضريبة القيمة المضافة المستحقة (VAT Payable)

#### ب. تعريف الحركات ومنطقها (Transactions & Logic)

**1. حركة بسيطة (حسابان فقط): "سند قبض من عميل"**

- **الاسم:** `Customer Payment Receipt`
- **المدخلات:**
  - `customer_name` (اسم العميل)
  - `amount_received` (المبلغ المستلم)
  - `payment_method` (طريقة الدفع: نقداً/بنك)
- **محرك المنطق:**

  ```
  // 1. تحديد حساب الدفع
  IF payment_method == "Cash" THEN
      debit_account = 1110 // الصندوق
  ELSE
      debit_account = 1120 // البنك
  END IF

  // 2. توجيه القيد
  DEBIT(debit_account, amount_received)
  CREDIT(Accounts_Receivable, amount_received) // حساب الذمم المدينة
  ```

**2. حركة معقدة (أكثر من حسابين): "فاتورة بيع سيارة بالآجل"**

- **الاسم:** `Credit Car Sale Invoice`
- **المدخلات:**
  - `customer_name` (اسم العميل)
  - `car_model` (موديل السيارة الذي سيتم ربطه بالمخزون)
  - `sale_price` (سعر البيع)
- **محرك المنطق:** (نفس المنطق المذكور في السيناريو الأول)

  ```
  cost_of_car = GET_COST(car_model)
  vat_rate = 0.16
  vat_amount = sale_price * vat_rate
  total_due = sale_price + vat_amount

  DEBIT(Accounts_Receivable, total_due)
  CREDIT(Sales_Revenue, sale_price)
  CREDIT(VAT_Payable, vat_amount)
  DEBIT(Cost_of_Goods_Sold, cost_of_car)
  CREDIT(Inventory_Cars, cost_of_car)
  ```

### الخطوة 2: مرحلة الاستخدام (أمثلة عملية لموظف الشركة)

#### مثال 1: بيع سيارة Toyota Camry بالآجل

لنفترض أن تكلفة السيارة على الشركة هي **80,000**.

1.  يفتح موظف المبيعات شاشة "فاتورة بيع سيارة بالآجل".
2.  يملأ الحقول:
    - اسم العميل: "شركة الأمل"
    - موديل السيارة: "Toyota Camry 2025"
    - سعر البيع: **100,000**
3.  يضغط "حفظ".

**النتيجة:** النظام يولد القيد التالي تلقائياً:

| الحساب                  | مدين (Debit) | دائن (Credit) | الوصف                                 |
| :---------------------- | :----------- | :------------ | :------------------------------------ |
| الذمم المدينة - عملاء   | 116,000      |               | إثبات دين على العميل (100,000+16,000) |
| إيرادات مبيعات السيارات |              | 100,000       | إثبات إيراد البيع                     |
| ضريبة القيمة المضافة    |              | 16,000        | إثبات ضريبة مستحقة للدولة             |
| تكلفة البضاعة المباعة   | 80,000       |               | إثبات مصروف تكلفة السيارة             |
| مخزون السيارات          |              | 80,000        | تخفيض المخزون بقيمة السيارة           |
| **المجموع**             | **196,000**  | **196,000**   | **القيد متوازن**                      |

#### مثال 2: استلام دفعة بقيمة 50,000 من "شركة الأمل" عبر البنك

1.  يفتح المحاسب شاشة "سند قبض من عميل".
2.  يملأ الحقول:
    - اسم العميل: "شركة الأمل"
    - المبلغ المستلم: **50,000**
    - طريقة الدفع: "بنك"
3.  يضغط "حفظ".

**النتيجة:** النظام يولد القيد التالي تلقائياً:

| الحساب                | مدين (Debit) | دائن (Credit) | الوصف            |
| :-------------------- | :----------- | :------------ | :--------------- |
| البنك                 | 50,000       |               | زيادة رصيد البنك |
| الذمم المدينة - عملاء |              | 50,000        | تخفيض دين العميل |
| **المجموع**           | **50,000**   | **50,000**    | **القيد متوازن** |

---

## ثالثاً: تصور الواجهات (UI Mockups)

استخدام Mermaid لتصميم واجهات معقدة قد يكون غير عملي. بدلاً من ذلك، سأقوم بتصميمها كنص منظم يوضح شكل الشاشة ومكوناتها.

### 1\. شاشة محرر المنطق (لـ فريق dynacc.ai)

```
+--------------------------------------------------------------------------+
| شاشة تكوين حركة تجارية جديدة                                               |
+--------------------------------------------------------------------------+
|                                                                          |
| اسم الحركة: [ فاتورة بيع سيارة بالآجل              ]                          |
|                                                                          |
| ------------------- مدخلات المستخدم (Inputs) -------------------        |
| [+ إضافة حقل]                                                            |
| 1. اسم الحقل: [customer_name] نوع البيانات: [نص]                          |
| 2. اسم الحقل: [car_model]     نوع البيانات: [قائمة من المخزون]          |
| 3. اسم الحقل: [sale_price]    نوع البيانات: [رقم عشري]                     |
|                                                                          |
| ------------------- محرك المنطق والقواعد (Logic) -----------------        |
| |                                                                        |
| | cost_of_car = GET_COST(car_model)                                      |
| | vat_amount = sale_price * 0.16                                         |
| | total_due = sale_price + vat_amount                                    |
| | ...                                                                    |
| |                                                                        |
|                                                                          |
| ------------------- هيكل القيد المحاسبي (Output) ----------------        |
|                                                                          |
| الطرف | الحساب            | القيمة                                        |
|-------|-------------------|---------------------------------------------|
| مدين  | الذمم المدينة      | total_due                                   |
| دائن   | إيرادات المبيعات   | sale_price                                  |
| دائن   | ضريبة مستحقة     | vat_amount                                  |
| مدين  | تكلفة البضاعة     | cost_of_car                                 |
| دائن   | المخزون           | cost_of_car                                 |
|                                                                          |
|                                                     [ حفظ التكوين ]      |
+--------------------------------------------------------------------------+
```

### 2\. شاشة إدخال الفاتورة (لـ عميل شركة السيارات)

```
+--------------------------------------------------------------------------+
| فاتورة بيع سيارة جديدة                                                    |
+--------------------------------------------------------------------------+
|                                                                          |
|                                               التاريخ: [ 14-09-2025 ]    |
|                                                                          |
| اسم العميل:   [ شركة الأمل                     ] (بحث)                    |
|                                                                          |
| موديل السيارة: [ Toyota Camry 2025              ] (قائمة)                  |
|                                                                          |
| سعر البيع:     [ 100,000                       ]                          |
|                                                                          |
|                                                                          |
| -- النظام سيقوم بحساب الضريبة وتوليد القيد تلقائياً --                      |
|                                                                          |
|                                                                          |
|                                                      [ حفظ الفاتورة ]      |
+--------------------------------------------------------------------------+

```
